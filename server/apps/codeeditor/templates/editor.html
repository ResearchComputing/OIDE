{% extends "../../../lib/templates/base.html" %}

{% block extra_style %}
<link href="/static/css/jquery.contextMenu.css" rel="stylesheet" type="text/css" />
<link href="/static/css/filetree.css" rel="stylesheet" type="text/css" />
<link href="/static/css/editor.css" rel="stylesheet" type="text/css" />
{% end %}

{% block modal %}
{% include "../../../lib/templates/confirm-modal.html" %}

<div class="modal fade" id="modal-loading">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        Please wait while we resume your session.
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade" id="modal-save">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title">Save File As</h4>
      </div>
      <div class="modal-body">
        <form class="form-horizontal" role="form">
          <div class="form-group">
            <label for="inputFileName" class="col-sm-2 control-label">Save As</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="inputFileName" value="filename.txt">
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label">Location</label>
            <div class="col-sm-10">
              <div id="filepath-preview" style="padding-top:8px;">
                /somepath/filename.txt
              </div>
              <div id="modal-save-filetree-wrapper" style="padding-top:8px;">
                {% include "../../../apps/filebrowser/templates/filetree.html" %}
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button id="modal-button-save-close" type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button id="modal-button-save" type="button" class="btn btn-primary">Save file</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade" id="modal-open">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title">Open Files</h4>
      </div>
      <div class="modal-body">
      <div id="modal-open-filetree-wrapper">
        {% include "../../../apps/filebrowser/templates/filetree.html" %}
      </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button id="modal-button-open" type="button" class="btn btn-primary">Open files</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade" id="modal-upload">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title">File Uploader</h4>
      </div>
      <div class="modal-body">
        
        <h5>
          <span>Upload Directory:&nbsp;</span>
          <span id="upload_basepath"></span>
        </h5>
        
        <p>
          <span class="btn btn-success fileinput-button">
            <span class="glyphicon glyphicon-plus">&nbsp;</span>Add files...
            <input id="fileupload" type="file" name="files[]" data-url="/filebrowser/a/upload" multiple>
          </span>
          
          <button id="start_upload" class="btn btn-primary" type="button">
            <span class="glyphicon glyphicon-upload">&nbsp;</span>Start uploads
          </button>
          
          <button id="stop_uploads" class="btn btn-warning" type="button">
            <span class="glyphicon glyphicon-ban-circle">&nbsp;</span>Cancel all uploads
          </button>
        </p>
        
        <p>
          <span>Total progress: <span id="total_progress">0%</span></span>
        </p>
        
        <table id="files" class="table">
        </table>
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

{% end %}

{% block content %}
<div class="container-fluid">

<div id="options-panel">
  <div style="width: 95%; height: 90%; position: absolute; overflow: hidden; top:5px; bottom:0">
  <div style="width: 100%; height:100%;">
    <!-- Nav tabs -->
    <ul class="nav nav-pills" role="tablist">
      <li class="active"><a href="#filesystem" role="tab" data-toggle="tab">Filesystem</a></li>
      <li><a href="#menu" role="tab" data-toggle="tab">Menu</a></li>
      <!--<li><a href="#filetransfer" role="tab" data-toggle="tab">Upload</a></li>-->
    </ul>
    <!-- Tab panes -->
    <div style="width: 120%; height:100%; overflow-y: scroll">
    <div class="tab-content" style="width: 85%; padding-top: 10px; height:100%;">
      <div class="tab-pane active" id="filesystem">
          {% include "../../../apps/filebrowser/templates/filetree.html" %}
      </div>
      <div class="tab-pane" id="menu">
        <div class="controls-container">
          <div class="panel-group" id="accordion">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <a data-toggle="collapse" data-parent="#accordion" href="#menu-file">
                    File
                  </a>
                </h4>
              </div>
              <div id="menu-file" class="panel-collapse collapse in">
                <div class="panel-body">
                
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <tr><td id="menu-file-new">New File <small class="pull-right">Ctrl-N</small></td></tr>
                      <tr><td id="menu-file-open">Open... <small class="pull-right">Ctrl-O</small></td></tr>
                      <tr><td id="menu-file-save">Save <small class="pull-right">Ctrl-S</small></td></tr>
                      <tr><td id="menu-file-save-as">Save As... <small class="pull-right">Ctrl-Shift-S</small></td></tr>
                      <tr><td id="menu-file-close">Close File</td></tr>
                      <tr><td id="menu-file-close-all">Close All Files</td></tr>
                    </table>
                  </div>
                  
                </div>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <a data-toggle="collapse" data-parent="#accordion" href="#menu-edit">
                    Edit
                  </a>
                </h4>
              </div>
              <div id="menu-edit" class="panel-collapse collapse">
                <div class="panel-body">
                  
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <tr><td id="menu-edit-undo">Undo <small class="pull-right">Ctrl-Z</small></td></tr>
                      <tr><td id="menu-edit-redo">Redo <small class="pull-right">Ctrl-Y</small></td></tr>
                      <tr><td id="menu-edit-cut">Cut <small class="pull-right">Ctrl-X</small></td></tr>
                      <tr><td id="menu-edit-copy">Copy <small class="pull-right">Ctrl-C</small></td></tr>
                      <tr><td id="menu-edit-paste">Paste <small class="pull-right">Ctrl-V</small></td></tr>
                      <tr><td id="menu-edit-comment-selection">Comment Selection <small class="pull-right">Ctrl-/</small></td></tr>
                    </table>
                  </div>
                  
                </div>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <a data-toggle="collapse" data-parent="#accordion" href="#menu-find">
                    Find
                  </a>
                </h4>
              </div>
              <div id="menu-find" class="panel-collapse collapse">
                <div class="panel-body">
                  
                  <form role="form">
                    <div class="form-group">
                      <label for="find-string">Find</label>
                      <input type="text" class="form-control" id="find-string" placeholder="Search string...">
                    </div>
                    
                    <div class="form-group">
                      <div class="btn-group btn-group-sm">
                        <button id="find-find-previous" type="button" class="btn btn-default">&laquo; Find Previous</button>
                        <button id="find-find-next" type="button" class="btn btn-default">Find Next &raquo;</button>
                      </div>
                    </div>
                    
                    <div class="form-group">
                      <label for="replace-string">Replace With</label>
                      <input type="text" class="form-control" id="replace-string" placeholder="Replacement string...">
                    </div>
                   
                    <div class="form-group">
                      <div class="btn-group btn-group-sm">
                        <button id="find-replace-current" type="button" class="btn btn-default">Replace Current</button>
                        <button id="find-replace-all" type="button" class="btn btn-default">Replace All</button>
                      </div>
                    </div>
                    
                    <div class="checkbox">
                      <label>
                        <input id="find-case-sensitive" type="checkbox"> Case Sensitive
                      </label>
                    </div>
                    <div class="checkbox">
                      <label>
                        <input id="find-regular-expressions" type="checkbox"> Regular Expressions
                      </label>
                    </div>
                    <div class="checkbox">
                      <label>
                        <input id="find-whole-word" type="checkbox"> Whole Word
                      </label>
                    </div>
                    <div class="checkbox">
                      <label>
                        <input id="find-wrap-around" type="checkbox"> Wrap Around
                      </label>
                    </div>
                  </form>
                  
                </div>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <a data-toggle="collapse" data-parent="#accordion" href="#menu-settings">
                    Settings
                  </a>
                </h4>
              </div>
              <div id="menu-settings" class="panel-collapse collapse">
                <div class="panel-body">
                  
                  <form id="settings-form" role="form">
                    <div class="checkbox">
                      <label>
                        <input id="settings-wrap-selection" type="checkbox" checked> Wrap selection with Parentheses, Brackets, etc.
                      </label>
                    </div>
                    <div class="checkbox">
                      <label>
                        <input id="settings-soft-tabs" type="checkbox" checked> Use soft tabs
                      </label>
                    </div>
                    <div class="form-group">
                      <label for="settings-tab-size">Tab size</label>
                      <select id="settings-tab-size" class="form-control">
                        <option value=1>1</option>
                        <option value=2>2</option>
                        <option value=3>3</option>
                        <option value=4 selected="selected">4</option>
                        <option value=5>5</option>
                        <option value=6>6</option>
                        <option value=7>7</option>
                        <option value=8>8</option>
                      </select>
                    </div>
                    <div class="checkbox">
                      <label>
                        <input id="settings-show-invisibles" type="checkbox"> Show invisible characters
                      </label>
                    </div>
                    <div class="form-group">
                      <label for="settings-font-size">Font Size</label>
                      <select id="settings-font-size" class="form-control">
                        <option value=10>10</option>
                        <option value=12 selected="selected">12</option>
                        <option value=14>14</option>
                        <option value=16>16</option>
                        <option value=18>18</option>
                        <option value=20>20</option>
                      </select>
                    </div>
                  </form>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--<div class="tab-pane" id="filetransfer">-->
      <!--  <div class="controls-container">-->
          <!--<ul id="editor-tabs" class="nav nav-pills nav-stacked">-->
          <!--  <li>-->
          <!--    <a href="#editortab-new" role="tab" data-toggle="tab">-->
          <!--      <span class="glyphicon glyphicon-plus"> New</span>-->
          <!--    </a>-->
          <!--  </li>-->
          <!--</ul>-->
        <!--</div>-->
      <!--</div>-->
      </div>
    </div>
  </div>
  </div>
</div>

<div id="editor-wrapper">
  <div id="workspace">
    <ul id="editor-tabs" class="nav nav-pills">
      <li>
        <a href="#editortab-new" role="tab" data-toggle="tab">
          <span class="glyphicon glyphicon-plus"> New</span>
        </a>
      </li>
    </ul>
  </div>
  <div id="editor"></div>
  <div id="editor-info"></div>
</div>

{% end %}

{% block end_script %}
<script src="/static/js/confirmmodalmanager.js"></script>
<script src="/static/js/filetree.js"></script>
<script>
$(document).ready(function(e) {
  FileTree.bindEventHandlers('filesystem',true);
  FileTree.bindEventHandlers('modal-open-filetree-wrapper',true);
  FileTree.bindEventHandlers('modal-save-filetree-wrapper',false);
  
  FileTree.custom.onSaveFileSelect = function(event) {
      event.stopPropagation();
      var filePath = $(this).siblings('input:first').attr('value');
      var fileNameIndex = filePath.lastIndexOf('/')+1;
      var fileName = filePath.substr(fileNameIndex);
      $('#inputFileName').attr('value',fileName);
      $('#filepath-preview').text(filePath);
      if ($('#modal-button-save').prop('disabled')) {
        $('#modal-button-save').attr('disabled',false);
      }
    };
    
  FileTree.custom.onSaveDirectorySelect = function(event) {
      event.stopPropagation();
      // var filePath = $('#filepath-preview').text();
      // var fileNameIndex = filePath.lastIndexOf('/')+1;
      var fileName = $('#inputFileName').attr('value');
      var basePath = $(this).siblings('input:first').attr('value');
      $('#filepath-preview').text(basePath+fileName);
      if ($('#modal-button-save').prop('disabled')) {
        $('#modal-button-save').attr('disabled',false);
      }
    };
  
  FileTree.addCustomEventHandler('modal-save-filetree-wrapper','.file','click',FileTree.custom.onSaveFileSelect);
  FileTree.addCustomEventHandler('modal-save-filetree-wrapper','.directory','click',FileTree.custom.onSaveDirectorySelect);
  FileTree.startPolling(['filesystem','modal-open-filetree-wrapper','modal-save-filetree-wrapper'],1000);
});
</script>
<script src="/static/js/jquery.ui.widget.js"></script>
<script src="/static/js/jquery.iframe-transport.js"></script>
<script src="/static/js/jquery.fileupload.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/json2/20130526/json2.js" type="text/javascript"></script>
<script src="/static/js/fileuploader.js"></script>
<script src="/static/js/jquery.ui.position.js"></script>
<script src="/static/js/jquery.contextMenu.js"></script>
<script src="/static/ace/src/ace.js"></script>
<script src="/static/js/aceModes.js"></script>
<script src="/static/js/contextmenu.manager.js"></script>
<script src="/static/js/editormanager.js"></script>
<script src="/static/js/filemanager.js"></script>
<script src="/static/js/editormenus.js"></script>
<script>
EditorManager.setUp();
ContextMenuManager.setUpMenus();
$("#editor-wrapper").resizable({ handles: "w" });
$(window).on('beforeunload',function(e) {
  EditorManager.tearDown();
  for (var sess in EditorManager.sessions) {
    if (EditorManager.isUnsaved(sess)) {
      return 'There are unsaved changes in your session!';
    }
  };
});
</script>
<script src="/static/js/editor.ui.js"></script>
{% end %}